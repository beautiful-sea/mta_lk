local gates =
{
	{ gate = createObject(2930, 2447.9118652344, -4075.6005859375, 423.35189819336, 0, 0, 0), offset = { 0 , -1.6, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2447.9897460938, -4099.3266601563, 423.35162353516, 0, 0, 0), offset = { 0 , -1.6, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2445.3024902344, -4095.1684570313, 423.35232543945, 0, 0, 89.921997070313), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2453.0537109375, -4077.4580078125, 423.35232543945, 0, 0, 89.983520507813), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2460.4541015625, -4077.4655761719, 423.35232543945, 0, 0, 89.917602539063), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2456.6584472656, -4077.4616699219, 423.35232543945, 0, 0, 89.983520507813), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2464.0812988281, -4077.4721679688, 423.35232543945, 0, 0, 89.917602539063), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2467.6940917969, -4077.4904785156, 423.35232543945, 0, 0, 90.529541015625), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2471.3291015625, -4077.4990234375, 423.35232543945, 0, 0, 90.52734375), offset = { -1.6 , 0, 0, 0, 0, 0 } },

	
	{ gate = createObject(2930, 2470.7614746094, -4098.05859375, 423.35232543945, 0, 0, 90.52734375), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2467.0842285156, -4098.0576171875, 423.35232543945, 0, 0, 90.52734375), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2463.4841308594, -4098.0551757813, 423.35232543945, 0, 0, 90.52734375), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2459.8735351563, -4098.0522460938, 423.35232543945, 0, 0, 90.52734375), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2456.2233886719, -4098.0483398438, 423.35232543945, 0, 0, 90.52734375), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2452.5480957031, -4098.0478515625, 423.35232543945, 0, 0, 90.52734375), offset = { -1.6 , 0, 0, 0, 0, 0 } },

	{ gate = createObject(2930, 2452.5478515625, -4098.0478515625, 416.50204467773, 0, 0, 90.52734375), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2453.0537109375, -4077.4682617188, 416.5036315918, 0, 0, 89.983520507813), offset = { -1.6 , 0, 0, 0, 0, 0 } },

	{ gate = createObject(2930, 2456.75, -4077.4643554688, 416.5036315918, 0, 0, 89.983520507813), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2460.4658203125, -4077.4716796875, 416.5036315918, 0, 0, 89.983520507813), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2464.076171875, -4077.5087890625, 416.5036315918, 0, 0, 89.983520507813), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2467.6745605469, -4077.4938964844, 416.5036315918, 0, 0, 89.983520507813), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2471.3095703125, -4077.478515625, 416.5036315918, 0, 0, 89.983520507813), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2470.8725585938, -4098.052734375, 416.5036315918, 0, 0, 89.983520507813), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2467.2109375, -4098.0639648438, 416.5036315918, 0, 0, 89.983520507813), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2463.6174316406, -4098.0673828125, 416.5036315918, 0, 0, 89.983520507813), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2459.9599609375, -4098.04296875, 416.50204467773, 0, 0, 89.983520507813), offset = { -1.6 , 0, 0, 0, 0, 0 } },
	{ gate = createObject(2930, 2456.2705078125, -4098.041015625, 416.50204467773, 0, 0, 89.983520507813), offset = { -1.6 , 0, 0, 0, 0, 0 } }
}

for _, gate in pairs(gates) do
	setElementInterior(gate.gate, 2)
	setElementDimension(gate.gate, 60)
end

local function resetBusy( shortestID )
	gates[ shortestID ].busy = nil
end

local function closeDoor( shortestID )
	gate = gates[ shortestID ]
	local nx, ny, nz = getElementPosition( gate.gate )
	moveObject( gate.gate, 1000, nx - gate.offset[1], ny - gate.offset[2], nz - gate.offset[3], -gate.offset[4], -gate.offset[5], -gate.offset[6] )
	gate.busy = true
	gate.timer = nil
	setTimer( resetBusy, 1000, 1, shortestID )
end

local function openDoor(thePlayer, commandName, pass)
	if getTeamName(getPlayerTeam(thePlayer)) == "San Andreas Correctional Facility" and getElementDimension(thePlayer) == 60 then
		local shortest, shortestID, dist = nil, nil, 10
		local px, py, pz = getElementPosition(thePlayer)
		
		for id, gate in pairs(gates) do
			local d = getDistanceBetweenPoints3D(px,py,pz,getElementPosition(gate.gate))
			if d < dist then
				shortest = gate
				shortestID = id
				dist = d
			end
		end
		
		if shortest then
			if shortest.busy then
				return
			elseif shortest.timer then
				killTimer( shortest.timer )
				shortest.timer = nil
				outputChatBox( "The door is already open!", thePlayer, 0, 255, 0 )
			else
				local nx, ny, nz = getElementPosition( shortest.gate )
				moveObject( shortest.gate, 1000, nx + shortest.offset[1], ny + shortest.offset[2], nz + shortest.offset[3], shortest.offset[4], shortest.offset[5], shortest.offset[6] )
				outputChatBox( "You opened the door!", thePlayer, 0, 255, 0 )
			end
			shortest.timer = setTimer( closeDoor, 5000, 1, shortestID )
		end
	end
end
addCommandHandler( "gate", openDoor)